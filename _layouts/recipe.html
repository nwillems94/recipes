---
layout: post
---

<div style="display: flex; align-items: flex-start; gap: 1rem;">
  <h1 style="flex: 1; margin: 0;">{{ page.title }}</h1>
  {% if page.tags %}
    <span style="font-size: 1.5rem; line-height: 1.2; white-space: nowrap; display: flex; align-items: center; min-height: 1em;">{{ page.tags }}</span>
  {% endif %}
</div>

<button class="share-button" onclick="shareRecipe()">Share Recipe</button>

<div class="recipe-card">
  <details open>
  <summary> <h2 style="display:inline-block; padding-left:0.25rem">Ingredients</h2> </summary>

  <label for="servings">Servings:</label>
  <input type="number" id="servings" value="{{ page.servings }}" min="1" onchange="updateIngredients()">

  <ul id="ingredientList" class="ingredients">
    {% for ingredient in page.ingredients %}
      <li data-quantity="{{ ingredient.quantity | join: ';' }}">
        {% if ingredient.quantity %}
          {% for qty in ingredient.quantity %}
            {% if forloop.first %}
              <span class="qty" data-index="0">{{ qty }}</span> {{ ingredient.unit[forloop.index0] | default: ingredient.unit }}
            {% else %}
              (<span class="qty" data-index="{{ forloop.index0 }}">{{ qty }}</span> {{ ingredient.unit[forloop.index0] | default: ingredient.unit }})
            {% endif %}
          {% endfor %}
        {% endif %}
        {{ ingredient.name }}
      </li>
    {% endfor %}
  </ul>
  </details>

  <p>{{ content }}</p>
</div>


<script>
  const defaultServings = parseFloat("{{ page.servings }}");

  function formatQuantity(qty) {
    const rounded = Math.round(qty * 100) / 100;
    return Number.isInteger(rounded)
      ? rounded.toString()
      : rounded.toFixed(2).replace(/\.?0+$/, '');
  }

  function updateIngredients() {
    const newServings = parseFloat(document.getElementById('servings').value);
    document.querySelectorAll('#ingredientList li').forEach(item => {
      let baseQtys = [];
      const qtyAttr = item.getAttribute('data-quantity');
      if (qtyAttr && qtyAttr.trim()) {
        baseQtys = qtyAttr.split(';').map(q => parseFloat(q.trim())).filter(q => !isNaN(q));
      }

      item.querySelectorAll('.qty').forEach((span, index) => {
        const baseQty = baseQtys[index];
        if (!isNaN(baseQty)) {
          const newQty = (baseQty / defaultServings) * newServings;
          span.textContent = formatQuantity(newQty);
        }
      });
    });
  }

  function shareRecipe() {
    if (navigator.share) {
      navigator.share({
        title: document.title,
        url: window.location.href
      }).catch(console.error);
    } else {
      alert('Sharing not supported on this browser.');
    }
  }
</script>
