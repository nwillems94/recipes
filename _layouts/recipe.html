---
layout: post
---

<h1>{{ page.title }}</h1>

<button class="share-button" onclick="shareRecipe()">Share Recipe</button>

<div class="recipe-card">
  <h2>Ingredients</h2>

  <label for="servings">Servings:</label>
  <input type="number" id="servings" value="{{ page.servings }}" min="1" onchange="updateIngredients()">

  <ul id="ingredientList" class="ingredients">
    {% for ingredient in page.ingredients %}
      <li data-quantity="{{ ingredient.quantity | join: ';' }}" data-unit="{{ ingredient.unit | join: ';' }}" data-name="{{ ingredient.name }}">
        {% if ingredient.quantity %}
          {% for qty in ingredient.quantity %}
            {% if forloop.first %}
              <span class="qty" data-index="0">{{ qty }}</span> {{ ingredient.unit[forloop.index0] }}
            {% else %}
              (<span class="qty" data-index="{{ forloop.index0 }}">{{ qty }}</span> {{ ingredient.unit[forloop.index0] }})
            {% endif %}
          {% endfor %}
        {% endif %}
        {{ ingredient.name }}
      </li>
    {% endfor %}
  </ul>

  <p>{{ content }}</p>
</div>


<script>
  const defaultServings = parseFloat("{{ page.servings }}");

  function formatQuantity(qty) {
    const rounded = Math.round(qty * 100) / 100;
    return Number.isInteger(rounded)
      ? rounded.toString()
      : rounded.toFixed(2).replace(/\.?0+$/, '');
  }

  function updateIngredients() {
    const newServings = parseFloat(document.getElementById('servings').value);
    document.querySelectorAll('#ingredientList li').forEach(item => {
      let baseQtys = [];
      const qtyAttr = item.getAttribute('data-quantity');
      if (qtyAttr && qtyAttr.trim()) {
        baseQtys = qtyAttr.split(';').map(q => parseFloat(q.trim())).filter(q => !isNaN(q));
      }

      item.querySelectorAll('.qty').forEach((span, index) => {
        const baseQty = baseQtys[index];
        if (!isNaN(baseQty)) {
          const newQty = (baseQty / defaultServings) * newServings;
          span.textContent = formatQuantity(newQty);
        }
      });
    });
  }

  function shareRecipe() {
    if (navigator.share) {
      navigator.share({
        title: document.title,
        url: window.location.href
      }).catch(console.error);
    } else {
      alert('Sharing not supported on this browser.');
    }
  }
</script>
